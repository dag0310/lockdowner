<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Lockdowner</title>
<meta name="description" content="Nachschauen wie es mit dem Lockdown geht.">
<meta name="author" content="Daniel Geymayer">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta property="og:image" content="https://apps.geymayer.com/lockdowner/favicon.png">
<link rel="apple-touch-icon" sizes="16x16" href="favicon.png">
<link rel="icon" type="image/png" href="favicon.png" sizes="16x16">
<link rel="shortcut icon" href="favicon.png">
<style>
  * { box-sizing: border-box; }
  body { font-family: sans-serif; padding: 10px; max-width: 640px; }
  input, select { height: 40px; padding: 10px; margin-bottom: 10px; }
  button { min-height: 40px; padding: 10px; background-color: yellow; font-size: 16px; font-weight: bold; cursor: pointer; }
  input, select, button { width: 100%; max-width: 400px; border-radius: 5px; }
  h1 { margin-top: 0; }
</style>
<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://matomo.geymayer.com/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '8']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->
</head>
<body>
<h1>Lockdowner</h1>
<p>Laut MedUni-Wien-Vizerektor <a href="https://uniko.ac.at/organisation/mitglieder/map/E487/P9434/" target="_blank">Oswald&nbsp;Wagner</a> ist das Ziel die <a href="https://de.wikipedia.org/wiki/Inzidenz_(Epidemiologie)#7-Tage-Inzidenz" target="_blank"><strong>7-Tage-Inzidenz</strong></a> auf <strong>deutlich unter 50</strong> zu senken. Quelle: <a href="https://orf.at/stories/3197576/" target="_blank">orf.at / 16.1.2021</a></p>
<p id="chartText"></p>
<h3>7-Tage-Inzidenz Österreich:</h3>
<p id="latestValue"></p>
<canvas id="chart" width="100%" height="100"></canvas>
<p>Datenquelle: AGES/EMS</p>
<p><a href="https://github.com/dag0310/lockdowner" target="_blank">GitHub-Repository</a></p>
<script src="dayjs.min.js"></script>
<script src="Chart.min.js"></script>
<script>
'use strict'

// TODO: Make these start parameters configurable
const LOCKDOWN_END_DATE = '2021-02-08'
const LOCKDOWN_END_VALUE = 50
const LAST_X_DAYS = 100

const buildEntriesFuture = (entries, lockdownEndDate, lockdownEndValue) => {
  const entriesFuture = JSON.parse(JSON.stringify(entries))
  entriesFuture.pop();
  for (const entry of entriesFuture) {
    entry.sevenDayIncidency = null;
  }
  const mostRecentDay = entries[entries.length - 1];
  const daysDiff = dayjs(lockdownEndDate).diff(mostRecentDay.date, 'day');
  const valueDiff = lockdownEndValue - mostRecentDay.sevenDayIncidency;
  const valuePerDay = valueDiff / daysDiff;
  for (let day = 0; day <= daysDiff; day += 1) {
    entriesFuture.push({
      date: dayjs(mostRecentDay.date).add(day, 'days').format('YYYY-MM-DD'),
      sevenDayIncidency: mostRecentDay.sevenDayIncidency + (valuePerDay * day)
    })
  }
  return entriesFuture;
};

(async () => {
  const entriesRaw = await (await fetch('covid-austria.json')).json();
  const entriesPast = (LAST_X_DAYS != null) ? entriesRaw.slice(entriesRaw.length - LAST_X_DAYS) : entriesRaw;
  const entriesFuture = buildEntriesFuture(entriesPast, LOCKDOWN_END_DATE, LOCKDOWN_END_VALUE);

  const latestEntry = entriesPast.slice(-1)[0];
  document.getElementById('latestValue').innerHTML = `Letzter Wert vom ${dayjs(latestEntry.date).format('DD.MM.')}: <b>${latestEntry.sevenDayIncidency}</b>`;
  document.getElementById('chartText').innerText = `Die rote Linie zeigt den benötigten Verlauf an, um den Wert ${LOCKDOWN_END_VALUE} bis zum ${dayjs(LOCKDOWN_END_DATE).format('DD.MM.YYYY')} zu erreichen.`;
  const ctx = document.getElementById('chart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: entriesFuture.map(entry => dayjs(entry.date).format('DD.MM.YYYY')),
      datasets: [
        {
          label: 'Datenbestand',
          data: entriesPast.map(entry => entry.sevenDayIncidency),
          pointRadius: 1,
          pointHoverRadius: 5,
          backgroundColor: 'transparent',
          borderColor: 'blue',
        },
        {
          label: `zukünftiger Verlauf`,
          data: entriesFuture.map(entry => entry.sevenDayIncidency),
          pointRadius: 1,
          pointHoverRadius: 5,
          backgroundColor: 'transparent',
          borderColor: 'red',
        },
      ],
    },
    options: {
      title: {
        text: '7-Tage-Inzidenz Österreich'
      },
      scales: {
        xAxes: [{
          scaleLabel: {
            display: true,
            labelString: 'Datum',
          }
        }],
        yAxes: [{
          scaleLabel: {
            display: true,
            labelString: '7-Tage-Inzidenz',
          },
          ticks: {
            beginAtZero: true,
          },
        }],
      },
    },
  });
})();
</script>
</body>
</html>